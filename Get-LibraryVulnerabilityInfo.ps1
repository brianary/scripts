<#
.Synopsis
    Get the list of module/package/library vulnerabilities from the RetireJS or SafeNuGet projects.

.Parameter Name
    The name of the module or package or library to check.

.Parameter Repository
    Whether to check the NPM, JS, or NuGet vulnerability lists.

.Inputs
    System.String of a package/module name to search for.

.Outputs
    System.Management.Automation.PSObject[] with details about any vulnerabilities found.

.Link
    Invoke-RestMethod

.Link
    Select-Xml

.Example
    Get-JsVulnerabilities.ps1 Backbone.js

    atOrAbove below identifiers                                                 
    --------- ----- -----------                                                 
              0.5.0 @{release=0.5.0; summary=cross-site scripting vulnerability}

.Example
    Get-JsVulnerabilities.ps1 Backbone.js -Repository nuget

    afterOrAt before infoUri                         
    --------- ------ -------                         
              0.5.3  http://backbonejs.org/#changelog
#>

#Requires -Version 3
[CmdletBinding()][OutputType([psobject[]])] Param(
[Parameter(Position=0,Mandatory=$true,ValueFromPipeline=$true)]
[Alias('Module','Package','Library')][string]$Name,
[ValidateSet('js','npm','nuget')][string]$Repository = 'js'
)
Process
{
    if($Repository -eq 'nuget')
    {
        Invoke-RestMethod https://raw.githubusercontent.com/OWASP/SafeNuGet/master/feed/unsafepackages.xml |
            Select-Xml //package |
            % Node |
            ? {$_.id -eq $Name} |
            select afterOrAt,before,infoUri
    }
    else
    {
        $lib = Invoke-RestMethod https://raw.githubusercontent.com/RetireJS/retire.js/master/repository/${Repository}repository.json
        if($lib.$Name) {$lib.$Name.vulnerabilities |select atOrAbove,below,identifiers,info}
        else {Write-Warning "$Name not found"}
    }
}
